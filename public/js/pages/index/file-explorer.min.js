Dropzone.autoDiscover=!1;var csrf_token=$('meta[name="csrf-token"]').attr("content");function bookmarkFile(e){$.ajax({url:"/index/bookmark-file/"+e,type:"POST",data:{_token:csrf_token},success:function(e){swal({title:"Bookmark Success!",text:e.data.name+", "+e.message,type:"success",timer:"2000"})},error:function(e){swal({title:"Bookmark Failed!",text:e.responseJSON.data.name+", "+e.responseJSON.message,type:"error",timer:"2000"})}})}function setComment(e){$.ajax({url:"/index/get-file/"+e,type:"GET",success:function(e){$("#comment-modals").modal("show"),0===e.is_file?($("#modal-caption").html('<i class="fa fa-folder"></i><span> Add/Update Comments</span>'),$("#file-name-modal").text("Folder Name: "+e.name)):($("#modal-caption").html('<i class="fa fa-file"></i><span> Add/Update Comments</span>'),$("#file-name-modal").text("File Name: "+e.name)),$("#label-file-comments").text("Comment: "),$("#comment-modals .file-comment").val(e.comment?e.comment:""),$("#fileCommentId").val(e.id),$("#fieldName").val("comment")},error:function(e){console.log(e)}})}$(document).ready(function(){var e,a=0,l="",t=$("input:hidden[name = f_id]").val(),i=$("#dt-file-exp-table-index").DataTable({processing:!0,serverSide:!0,ajax:{url:"/index/list-all/"+t,error:function(e,a,l){"Unauthorized"===l&&(window.location.href="/login")}},columns:[{data:"checkbox",name:"file-exp-checkbox",orderable:!1,searchable:!1},{data:"name",fnCreatedCell:function(e,a,l){"1"===l.is_file?$(e).html("<span><i class='fa fa-file fa-lg'></i></span>&nbsp; "+a):$(e).html("<span><i class='fa fa-folder fa-lg'></i></span>&nbsp; "+a)}},{data:"updated_at"},{data:"owner"},{data:"comment",fnCreatedCell:function(e,a,l){null!==a?$(e).html("<a class='btn btn-outline-warning btn-xs' onclick='setComment("+l.id+")'><span><i class='fa fa-comment fa-2x'></i></span></a> "+a):$(e).html("<a class='btn btn-outline-warning btn-xs' onclick='setComment("+l.id+")'><span><i class='fa fa-comment fa-2x'></i></span></a> ")}},{data:"action",name:"action",orderable:!1,searchable:!1}],columnDefs:[{targets:[0,1,2,3,4,5],className:"mdl-data-table__cell--non-numeric header-cursor"}],fnDrawCallback:function(){var e=this.api().ajax.json();a=e.mainRootFolderId,l=e.mainRootFolderName,$("#root-folder-name").text(l),t=e.mainRootFolderId}}),n=$("#dt-list-folder-table-index").DataTable({processing:!0,serverSide:!0,bPaginate:!1,bInfo:!1,dom:"<fl<t>ip>",ajax:"/index/list-folder/"+t,columns:[{data:"name",fnCreatedCell:function(e,a,l){$(e).html("<i class='fa fa-folder fa-lg'></i><span>&nbsp; "+a+"</span> <span class='pull-right'><small class='label bg-yellow'>"+l.child_count+"</small></span>")}}],fnDrawCallback:function(){var e=this.api(),t=e.ajax.json();a=t.rootFolderId,l=t.rootFolderName,$(e.column(0).header()).html($.fn.dataTable.render.text().display(t.rootFolderName))}});function o(e){i.ajax.url("/index/list-all/"+e).load(),n.ajax.url("/index/list-folder/"+e).load()}function s(e){i.ajax.url("/index/list-all/"+e).load(),n.ajax.url("/index/list-folder/"+e).load(),t=e}function r(){a>0&&(i.ajax.url("/index/list-all-previous/"+a).load(),n.ajax.url("/index/list-folder-previous/"+a).load())}$("#file-descr-id").val("");var d=new Dropzone("#upload-file-form",{paramName:"file",url:"/index/upload-files",method:"POST",maxFilesize:25,maxFiles:4,parallelUploads:4,uploadMultiple:!0,autoProcessQueue:!1,addRemoveLinks:!0,dictFileTooBig:"Max file size is 25MB",dictMaxFilesExceeded:"Max files uploaded is 4",success:function(){o(t)}});function c(e,a){!0===a?($("#file-descr-id").val(e.id),$(".file-descr-name").html('<i class="fa fa-usb fa-fw"></i> '+e.name+'<span class="pull-right">   <i class="fa fa-angle-double-right"></i></span>'),$("#file-descr-text").text(e.description)):($("#file-descr-id").val(""),$(".file-descr-name").html('<i class="fa fa-usb fa-fw"></i> <span class="pull-right">   <i class="fa fa-angle-double-right"></i></span>'),$("#file-descr-text").text(""))}$("#dt-file-exp-table-index tbody").on("change","input[type='checkbox']",function(){if(!this.checked){var e=$("#file-exp-select-all").get(0);e&&e.checked&&"indeterminate"in e&&(e.indeterminate=!0)}}),$("#dt-file-exp-table-index tbody").on("click","tr",function(){var e=i.row(this).data();$(this).hasClass("is-selected")?($(this).removeClass("is-selected"),c(e,!1)):(i.$("tr.is-selected").removeClass("is-selected"),$(this).addClass("is-selected"),c(e,!0))}),$("#file-exp-select-all").on("click",function(){var e=i.rows({search:"applied"}).nodes();$('input[type="checkbox"]',e).prop("checked",this.checked)}),i.on("dblclick","tr",function(){var e=i.row(this).data().id;0===i.row(this).data().is_file?o(e):window.location.href="/index/detail/"+e}),n.on("dblclick","tr",function(){n.row(this).index()>=0&&s(n.row(this).data().id)}),$("#main-back").click(function(){r()}),$("#root-folder-name").click(function(){r()}),$("#create-new-folder-form").submit(function(l){l.preventDefault();var t=$("#create-new-folder-form").serialize();$("#folder-name-error").html(""),$.ajax({url:"/index/create-new-folder/"+a,type:"POST",data:t,success:function(l){l.errors?l.errors.folderName&&$("#folder-name-error").text(l.errors.folderName[0]):l.success&&($("#success-msg").removeClass("hide"),s(a),e=setInterval(function(){$("#create-new-folder-modal").modal("hide")},1e3))}})}),$("#create-new-folder-modal").on("shown.bs.modal",function(){$("#folderName").focus()}),$("#create-new-folder-modal").on("hidden.bs.modal",function(){$("#folderName").val(""),$("#success-msg").addClass("hide"),$("#folder-name-error").html(""),clearInterval(e)}),$("#btn-save-comment").on("click",function(){var e=$("#comments-form").serialize(),a=$("#fileCommentId").val();$.ajax({url:"/index/update-file/"+a,type:"POST",data:e,success:function(e){$("#comment-modals").modal("hide"),i.ajax.url("/index/list-all/"+e.data.folder_root).load(),"description"===e.tipe?($("#file-descr-text").text(e.data.description),c(e.data,!0)):c(null,!1),swal({title:"Success!",text:e.message,type:"success",timer:"1500"})},error:function(){swal({title:"Error!",text:"Something went wrong",type:"error",timer:"1500"})}})}),$("#btn-upload-files").on("click",function(){d.processQueue()}),d.on("sending",function(e,a,l){l.append("folderId",t),console.log(e.type)}),d.on("complete",function(e){d.removeFile(e)}),$("#edit-file-descr").on("click",function(e){e.preventDefault();let a=$("#file-descr-id").val();""!==a?$.ajax({url:"/index/get-file/"+a,type:"GET",success:function(e){$("#comment-modals").modal("show"),0===e.is_file?($("#modal-caption").html('<i class="fa fa-folder"></i><span> Add/Update Description</span>'),$("#file-name-modal").text("Folder Name: "+e.name)):($("#modal-caption").html('<i class="fa fa-file"></i><span> Add/Update Description</span>'),$("#file-name-modal").text("File Name: "+e.name)),$("#label-file-comments").text("Description: "),$("#comment-modals .file-comment").val(e.description?e.description:""),$("#fileCommentId").val(e.id),$("#fieldName").val("description")},error:function(e){console.log(e)}}):swal("Warning!!!","No files/folder selected","warning")}),$("#delete-file").on("click",function(e){e.preventDefault();let a=$("#file-descr-id").val(),l=$('meta[name="csrf-token"]').attr("content");""!==a?Swal({title:"Are you sure?",text:'"'+$("#file-descr-name").text()+"\" will be deleted. You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{e.value&&$.ajax({url:"/index/delete-file/"+a,type:"POST",data:{_method:"DELETE",_token:l},success:function(e){e.success&&(o(t),c(null,!1),Swal({title:"Success!",text:e.message,type:"success",timer:"2000"}))},fail:function(){Swal({title:"Failure!",text:"Your file/folder has not been deleted.",type:"error",timer:"2000"})}})}):swal("Warning!!!","No files/folder selected","warning")}),$("#view-file").on("click",function(e){e.preventDefault();let a=$("#file-descr-id").val();""!==a?$.ajax({url:"/index/get-file/"+a,type:"GET",success:function(e){1===e.is_file&&($(".bs-modal-view-file").modal("show"),$("#modal-view-caption").html('<i class="fa fa-file"></i><span> &nbsp;'+e.name+"</span>"),$("#iframe-view-file").attr("visibility","visible"),$("#iframe-view-file").attr("src",base_url+"/storage/index/"+e.url))},error:function(e){"401"===e.status&&(window.location.href="/login")}}):swal("Warning!!!","No files/folder selected","warning")}),$(".bs-modal-view-file").on("hidden.bs.modal",function(e){$("#iframe-view-file").attr("src","")})});