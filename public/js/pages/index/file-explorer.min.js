Dropzone.autoDiscover=!1;function bookmarkFile(a){var b=$('meta[name="csrf-token"]').attr('content');$.ajax({url:'/index/bookmark-file/'+a,type:'POST',data:{_token:b},success:function(c){swal({title:'Bookmark Success!',text:c.data.name+', '+c.message,type:'success',timer:'2000'})},error:function(c){swal({title:'Bookmark Failed!',text:c.responseJSON.data.name+', '+c.responseJSON.message,type:'error',timer:'2000'})}})}function setComment(a){$.ajax({url:'/index/get-file/'+a,type:'GET',success:function(b){$('#comment-modals').modal('show'),0===b.is_file?($('#modal-caption').html('<i class="fa fa-folder"></i><span> Add/Update Comments</span>'),$('#file-name-modal').text('Folder Name: '+b.name)):($('#modal-caption').html('<i class="fa fa-file"></i><span> Add/Update Comments</span>'),$('#file-name-modal').text('File Name: '+b.name)),$('#label-file-comments').text('Comment: '),$('#comment-modals .file-comment').val(b.comment?b.comment:''),$('#fileCommentId').val(b.id),$('#fieldName').val('comment')},error:function(b){console.log(b)}})}$(document).ready(function(){function a(n){k.ajax.url('/index/list-all/'+n).load(),l.ajax.url('/index/list-folder/'+n).load(),h=n}function b(n){k.ajax.url('/index/list-all/'+n).load(),l.ajax.url('/index/list-folder/'+n).load(),h=n}function c(){0<f&&(k.ajax.url('/index/list-all-previous/'+f).load(),l.ajax.url('/index/list-folder-previous/'+f).load())}function d(n,o){!0===o?($('#file-descr-id').val(n.id),$('.file-descr-name').html('<i class="fa fa-usb fa-fw"></i> '+n.name+'<span class="pull-right">   <i class="fa fa-angle-double-right"></i></span>'),$('#file-descr-text').text(n.description)):($('#file-descr-id').val(''),$('.file-descr-name').html('<i class="fa fa-usb fa-fw"></i> <span class="pull-right">   <i class="fa fa-angle-double-right"></i></span>'),$('#file-descr-text').text(''))}var f=0,g='',h,i,j=$('input:hidden[name = f_id]').val(),k=$('#dt-file-exp-table-index').DataTable({processing:!0,serverSide:!0,ajax:{url:'/index/list-all/'+j,error:function(n,o,p){'Unauthorized'===p&&(window.location.href='/login')}},rowId:'updated_at',select:!0,columns:[{data:'checkbox',name:'file-exp-checkbox',orderable:!1,searchable:!1},{data:'name',fnCreatedCell:function(n,o,p){'1'===p.is_file?$(n).html('<span><i class=\'fa fa-file fa-lg\'></i></span>&nbsp; '+o):$(n).html('<span><i class=\'fa fa-folder fa-lg\'></i></span>&nbsp; '+o)}},{data:'updated_at'},{data:'owner'},{data:'comment',fnCreatedCell:function(n,o,p){null===o?$(n).html('<a class=\'btn btn-outline-warning btn-xs\' onclick=\'setComment('+p.id+')\'><span><i class=\'fa fa-comment fa-2x\'></i></span></a> '):$(n).html('<a class=\'btn btn-outline-warning btn-xs\' onclick=\'setComment('+p.id+')\'><span><i class=\'fa fa-comment fa-2x\'></i></span></a> '+o)}},{data:'action',name:'action',orderable:!1,searchable:!1}],columnDefs:[{targets:[0,1,2,3,4,5],className:'mdl-data-table__cell--non-numeric'}],fnDrawCallback:function(){var n=this.api(),o=n.ajax.json();f=o.mainRootFolderId,g=o.mainRootFolderName,$('#root-folder-name').text(g)}}),l=$('#dt-list-folder-table-index').DataTable({processing:!0,serverSide:!0,bPaginate:!1,bInfo:!1,dom:'<fl<t>ip>',ajax:'/index/list-folder/'+j,columns:[{data:'name',fnCreatedCell:function(n,o,p){$(n).html('<i class=\'fa fa-folder fa-lg\'></i><span>&nbsp; '+o+'</span> <span class=\'pull-right\'><small class=\'label bg-yellow\'>'+p.child_count+'</small></span>')}}],fnDrawCallback:function(){var n=this.api(),o=n.ajax.json();f=o.rootFolderId,g=o.rootFolderName,$(n.column(0).header()).html($.fn.dataTable.render.text().display(o.rootFolderName))}});$('#file-descr-id').val('');var m=new Dropzone('#upload-file-form',{paramName:'file',url:'/index/upload-files',method:'POST',maxFilesize:25,maxFiles:4,parallelUploads:4,uploadMultiple:!0,autoProcessQueue:!1,addRemoveLinks:!0,dictFileTooBig:'Max file size is 25MB',dictMaxFilesExceeded:'Max files uploaded is 4',success:function(){a(h)}});$('#dt-file-exp-table-index tbody').on('change','input[type=\'checkbox\']',function(){if(!this.checked){var n=$('#file-exp-select-all').get(0);n&&n.checked&&'indeterminate'in n&&(n.indeterminate=!0)}}),$('#dt-file-exp-table-index tbody').on('click','tr',function(){var n=k.row(this).data();$(this).hasClass('is-selected')?($(this).removeClass('is-selected'),d(n,!1)):(k.$('tr.is-selected').removeClass('is-selected'),$(this).addClass('is-selected'),d(n,!0))}),$('#file-exp-select-all').on('click',function(){var n=k.rows({search:'applied'}).nodes();$('input[type="checkbox"]',n).prop('checked',this.checked)}),k.on('dblclick','tr',function(){var n=k.row(this).data().id;0===k.row(this).data().is_file&&a(n)}),l.on('dblclick','tr',function(){if(0<=l.row(this).index()){var n=l.row(this).data().id;b(n)}}),$('#main-back').click(function(){c()}),$('#root-folder-name').click(function(){c()}),$('#create-new-folder-form').submit(function(n){n.preventDefault();var o=$('#create-new-folder-form').serialize();$('#folder-name-error').html(''),$.ajax({url:'/index/create-new-folder/'+f,type:'POST',data:o,success:function(p){p.errors?p.errors.folderName&&$('#folder-name-error').text(p.errors.folderName[0]):p.success&&($('#success-msg').removeClass('hide'),b(f),i=setInterval(function(){$('#create-new-folder-modal').modal('hide')},1e3))}})}),$('#create-new-folder-modal').on('shown.bs.modal',function(){$('#folderName').focus()}),$('#create-new-folder-modal').on('hidden.bs.modal',function(){$('#folderName').val(''),$('#success-msg').addClass('hide'),$('#folder-name-error').html(''),clearInterval(i)}),$('#btn-save-comment').on('click',function(){var n=$('#comments-form').serialize(),o=$('#fileCommentId').val();$.ajax({url:'/index/update-file/'+o,type:'POST',data:n,success:function(p){$('#comment-modals').modal('hide'),k.ajax.url('/index/list-all/'+p.data.folder_root).load(),swal({title:'Success!',text:p.message,type:'success',timer:'1500'}),d(null,!1)},error:function(){swal({title:'Error!',text:'Something went wrong',type:'error',timer:'1500'})}})}),$('#btn-upload-files').on('click',function(){m.processQueue()}),m.on('sending',function(n,o,p){p.append('filesize',n.size),p.append('folderId',h)}),m.on('complete',function(n){m.removeFile(n)}),$('#upload-file-form').on('hidden.bs.modal',function(){m.complete(),a(f)}),$('#edit-file-descr').on('click',function(n){n.preventDefault();let o=$('#file-descr-id').val();return''===o?void swal('Warning!!!','No files/folder selected','warning'):void $.ajax({url:'/index/get-file/'+o,type:'GET',success:function(p){$('#comment-modals').modal('show'),0===p.is_file?($('#modal-caption').html('<i class="fa fa-folder"></i><span> Add/Update Description</span>'),$('#file-name-modal').text('Folder Name: '+p.name)):($('#modal-caption').html('<i class="fa fa-file"></i><span> Add/Update Description</span>'),$('#file-name-modal').text('File Name: '+p.name)),$('#label-file-comments').text('Description: '),$('#comment-modals .file-comment').val(p.description?p.description:''),$('#fileCommentId').val(p.id),$('#fieldName').val('description')},error:function(p){console.log(p)}})}),$('#delete-file').on('click',function(n){n.preventDefault();let o=$('#file-descr-id').val(),p=$('meta[name="csrf-token"]').attr('content');return''===o?void swal('Warning!!!','No files/folder selected','warning'):void Swal({title:'Are you sure?',text:'"'+$('#file-descr-name').text()+'" will be deleted. You won\'t be able to revert this!',type:'warning',showCancelButton:!0,confirmButtonColor:'#3085d6',cancelButtonColor:'#d33',confirmButtonText:'Yes, delete it!'}).then(q=>{q.value&&$.ajax({url:'/index/delete-file/'+o,type:'POST',data:{_method:'DELETE',_token:p},success:function(r){r.success&&(a(data.folder_root),Swal('Success!',r.message,'success'))},fail:function(){Swal('Failure!','Your file/folder has not been deleted.','error')}})})})});